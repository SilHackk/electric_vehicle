services:
  cp_engine_1:
    build:
      context: .
      dockerfile: Dockerfile.cp
    image: evcharging-cp
    container_name: evcharging_cp_engine_1
    environment:
      KAFKA_BROKER: 172.17.0.1:9092
    command: sh -c 'sleep 1Ä¯ && python charging_point/ev_cp_engine.py CP-001 40.5 -3.1 0.30 172.17.0.1 5000'
    ports:
      - "6001:6001"
    networks:
      - evcharging_net
    stdin_open: true
    tty: true

  cp_monitor_1:
    build:
      context: .
      dockerfile: Dockerfile.cp
    image: evcharging-cp
    container_name: evcharging_cp_monitor_1
    depends_on:
      - cp_engine_1
    environment:
      KAFKA_BROKER: 172.17.0.1:9092
    command: sh -c 'sleep 20 && python charging_point/ev_cp_monitor.py CP-001 172.17.0.1 5000'
    networks:
      - evcharging_net
    stdin_open: true
    tty: true

  cp_engine_2:
    build:
      context: .
      dockerfile: Dockerfile.cp
    image: evcharging-cp
    container_name: evcharging_cp_engine_2
    environment:
      KAFKA_BROKER: 172.17.0.1:9092
    command: sh -c 'sleep 15 && python charging_point/ev_cp_engine.py CP-002 40.4 -3.2 0.35 172.17.0.1 5000'
      - "6002:6002"
    networks:
      - evcharging_net
    stdin_open: true
    tty: true

  cp_monitor_2:
    build:
      context: .
      dockerfile: Dockerfile.cp
    image: evcharging-cp
    container_name: evcharging_cp_monitor_2
    depends_on:
      - cp_engine_2
    environment:
      KAFKA_BROKER: 172.17.0.1:9092
    command: sh -c 'sleep 20 && python charging_point/ev_cp_monitor.py CP-002 172.17.0.1 5000'
    networks:
      - evcharging_net
    stdin_open: true
    tty: true

  weather:
    build:
      context: .
      dockerfile: Dockerfile.weather
    image: evcharging-weather
    container_name: evcharging_weather
    depends_on:
      - central
      - registry
    environment:
      OPENWEATHER_API_KEY: ${OPENWEATHER_API_KEY}
      CENTRAL_API_URL: http://central:5003
    networks:
      - evcharging_net
    ports:
      - "5003:5003"
    stdin_open: true
    tty: true

networks:
  evcharging_net:
    driver: bridge
    